<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encargos Especiales | NC West Coast</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="NC.ico">
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
    
    <style>
        /* ESTILOS PARA LOS NUEVOS MODALES */
        .modal-pedido-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10001;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-pedido-box {
            background: #fff;
            width: 90%;
            max-width: 450px;
            padding: 30px;
            border-radius: 15px;
            position: relative;
            font-family: 'Montserrat', sans-serif;
        }

        .modal-pedido-box h2 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 600; font-size: 0.8rem; margin-bottom: 5px; color: #333; }
        /* Se agreg√≥ select para el dropdown de tallas */
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Montserrat', sans-serif;
            background-color: #fff;
        }

        /* Estilo del Ticket */
        #ticket-render {
            background: #fdfdfd;
            border: 2px dashed #bbb;
            padding: 20px;
            margin-bottom: 20px;
        }
        .ticket-header-img { text-align: center; margin-bottom: 10px; }
        .ticket-header-img img { width: 60px; border-radius: 50%; }
        .ticket-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; border-bottom: 1px solid #eee; }
        .ticket-item span:last-child { font-weight: 700; }

        .btn-modal {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-negro { background: #1a1a1a; color: #fff; }
        .btn-verde { background: #27ae60; color: #fff; }
        
        .cerrar-x { position: absolute; top: 15px; right: 20px; font-size: 25px; cursor: pointer; color: #aaa; }

        /* Contenedor del Acorde√≥n */
        .brands-accordion {
            max-width: 800px;
            margin: 30px auto;
            text-align: left;
        }

        .brand-item {
            border-bottom: 1px solid #ddd;
            margin-bottom: 10px;
        }

        .brand-toggle {
            width: 100%;
            padding: 15px;
            background: none;
            border: none;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            transition: color 0.3s;
        }

        .brand-toggle:hover {
            color: var(--gold-accent);
        }

        /* Contenido oculto por defecto */
        .brand-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out; /* Animaci√≥n m√°s suave */
            background-color: #fcfcfc;
            width: 100%;
        }

        .brand-item.active .brand-content {
            max-height: 2000px; /* Suficiente para que quepan todas las fotos del collage */
            padding: 10px 0;
        }

        .brand-item.active .arrow {
            transform: rotate(45deg);
            color: var(--gold-accent);
        }

        /* Ajuste para que las fotos del collage no se hagan gigantes */
        .collage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Se ajustan solas */
            gap: 15px;
            padding: 20px;
            justify-items: center;
        }

        .collage-grid img {
            width: 100%;
            max-width: 200px;      /* Tama√±o m√°ximo de cada foto */
            height: 200px;         /* Altura fija para que todas sean iguales */
            object-fit: contain;   /* Muestra el producto completo sin cortarlo */
            background: #fff;      /* Fondo blanco por si la imagen tiene transparencias */
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 1px solid #eee;
        }

        .collage-grid img:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Desktop: 4 columnas */
        @media (min-width: 768px) {
            .collage-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>

    <div id="preloader">
        <div class="loader-content">
            <img src="NC.jpg" alt="Cargando..." class="loader-logo">
            <div class="loader-line"></div>
        </div>
    </div>

    <a href="https://m.me/859771300559984" class="messenger-btn" target="_blank" title="Chatea con nosotros">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.373 0 0 4.983 0 11.133c0 3.5 1.758 6.614 4.605 8.654V24l4.105-2.256c1.05.29 2.164.45 3.29.45 6.627 0 12-4.983 12-11.133C24 4.983 18.627 0 12 0zm1.096 15.02L10.28 12.13 4.805 15.02l6.007-6.38 2.816 2.89 5.474-2.89-6.006 6.38z"/>
        </svg>
    </a>

    <header>
        <a href="index.html" class="brand-left">NC WEST COAST</a>
        <a href="index.html" class="logo-center">
            <img src="bolso.png" alt="NC Logo" class="logo-img">
        </a>
        <ul class="nav-menu">
            <li><a href="index.html" class="nav-link" onclick="closeMenu()">Inicio</a></li>
            <li><a href="outlet.html" class="nav-link" onclick="closeMenu()">Outlet</a></li>
            <li><a href="shop.html" class="nav-link" onclick="closeMenu()">Cosmeticos</a></li>
            <li><a href="encargos.html" class="nav-link active" onclick="closeMenu()">Encarga</a></li>
        </ul>
        <div class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
    </header>

    <section class="encargos-hero">
        <div class="encargos-content">
            <h1>PERSONAL SHOPPER</h1>
            <p>¬øLo viste en USA? Nosotros te lo traemos.</p>
            <div class="hero-divider"></div>
            <p class="hero-subtext">Tenis exclusivos, bolsos de dise√±ador, cosmeticos y m√°s.</p>
        </div>
    </section>

    <section class="steps-section">
        <h2 class="section-title">¬øC√≥mo hacer un encargo?</h2>
        <div class="steps-grid">
            <div class="step-card">
                <div class="step-icon">üì∏</div>
                <h3>1. Busca tu Producto</h3>
                <p>Encuentra el art√≠culo que deseas en cualquier tienda online (Nike, Sephora, Amazon, etc.) o m√°ndanos una foto.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">üîó</div>
                <h3>2. Genera tu Link</h3>
                <p>Crea un ticket digital con tus datos y env√≠anos el enlace por Messenger.</p>
            </div>
            <div class="step-card">
                <div class="step-icon">üì¶</div>
                <h3>3. Rec√≠belo en Casa</h3>
                <p>Pagamos los impuestos por ti. Solo espera a que llegue a tu puerta.</p>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <button class="order-btn" onclick="abrirModalForm()">INICIAR PEDIDO</button>
        </div>
    </section>

   <section class="brands-section">
    <h3>Podemos conseguirte marcas como:</h3>
    <div class="brands-accordion">
        <div class="brand-item">
            <button class="brand-toggle">Nike <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://dpjye2wk9gi5z.cloudfront.net/wcsstore/ExtendedSitesCatalogAssetStore/images/catalog/zoom/1030680-0100V1.jpg" onclick="abrirModalForm('Nike')" alt="Nike item 1">
                    <img src="https://static.nike.com/a/images/t_web_pdp_936_v2/f_auto,u_126ab356-44d8-4a06-89b4-fcdcc8df0245,c_scale,fl_relative,w_1.0,h_1.0,fl_layer_apply/882c8d1f-2ff0-41ca-9d33-04438ab90473/AIR+JORDAN+1+RETRO+LOW+OG.png" onclick="abrirModalForm('Nike')" alt="Nike item 2">
                    <img src="https://static.nike.com/a/images/t_web_pdp_535_v2/f_auto,u_126ab356-44d8-4a06-89b4-fcdcc8df0245,c_scale,fl_relative,w_1.0,h_1.0,fl_layer_apply/151671f3-74e9-409e-86f0-d5a62055996c/AIR+JORDAN+1+MID.png" onclick="abrirModalForm('Nike')" alt="Nike item 3">
                    <img src="https://static.nike.com/a/images/t_web_pw_592_v2/f_auto/u_126ab356-44d8-4a06-89b4-fcdcc8df0245,c_scale,fl_relative,w_1.0,h_1.0,fl_layer_apply/36abf0fc-f600-4627-a06d-feb191ca3582/AIR+JORDAN+1+MID.png" onclick="abrirModalForm('Nike')" alt="Nike item 4">
                </div>
            </div>
        </div>

        <div class="brand-item">
            <button class="brand-toggle">Adidas <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://assets.adidas.com/images/w_600,f_auto,q_auto/ae9587cb634b4113b94a264aa874e125_9366/Tenis_Superstar_Negro_JI0079_00_plp_standard.jpg" onclick="abrirModalForm('Adidas')" alt="Nike item 1">
                    <img src="https://m.media-amazon.com/images/I/21kjNxhHdTL._AC_SY900_.jpg" onclick="abrirModalForm('Adidas')" alt="Nike item 2">
                    <img src="https://stylo.mx/cdn/shop/files/R239988-1_1_grd.jpg?v=1729097873" onclick="abrirModalForm('Adidas')" alt="Nike item 3">
                    <img src="https://s3-us-west-1.amazonaws.com/calzzapato/zoom/09GR0T-1.jpg" onclick="abrirModalForm('Adidas')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Under Armor <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://ss203.liverpool.com.mx/xl/1157495820.jpg" onclick="abrirModalForm('Under Armor')" alt="Nike item 1">
                    <img src="https://underarmour.scene7.com/is/image/Underarmour/3027593-001_DEFAULT?rp=standard-30pad|pdpMainDesktop&scl=1&fmt=jpg&qlt=85&resMode=sharp2&cache=on,on&bgc=f0f0f0&wid=566&hei=708&size=536,688" onclick="abrirModalForm('Under Armor')" alt="Nike item 2">
                    <img src="https://underarmour.scene7.com/is/image/Underarmour/6006061-002_DEFAULT?rp=standard-30pad|gridTileDesktop&scl=1&fmt=jpg&qlt=50&resMode=sharp2&cache=on,on&bgc=F0F0F0&wid=512&hei=640&size=472,600" onclick="abrirModalForm('Under Armor')" alt="Nike item 3">
                    <img src="https://sportmasters.com.mx/cdn/shop/files/2025430-102-001.jpg?v=1720814857&width=1000" onclick="abrirModalForm('Under Armor')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">New Balance <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://pngimg.com/d/running_shoes_PNG5792.png" onclick="abrirModalForm('New Balance')" alt="Nike item 1">
                    <img src="https://mrshoesaccessories.com/cdn/shop/files/9E16D9E4-947F-4E18-B108-82527503C49B.png?v=1747543338&width=2048" onclick="abrirModalForm('New Balance')" alt="Nike item 2">
                    <img src="https://savagetoo.com/cdn/shop/files/A5AE3652-CD69-4985-9E93-AD271BE0F1DE.png?v=1714944629&width=1445" onclick="abrirModalForm('New Balance')" alt="Nike item 3">
                    <img src="https://mrshoesaccessories.com/cdn/shop/files/6C6C4CF6-81DE-49B5-AC96-45E329A38185.png?v=1747545269&width=3375" onclick="abrirModalForm('New Balance')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Crocs <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://crocs.com.mx/cdn/shop/files/207937_1FT_ALT110.png?v=1761167920&width=780" onclick="abrirModalForm('Crocs')" alt="Nike item 1">
                    <img src="https://crocs.com.mx/cdn/shop/files/211503_90H_ALT100.png?v=1765242692&width=780" onclick="abrirModalForm('Crocs')" alt="Nike item 2">
                    <img src="https://crocs.com.mx/cdn/shop/files/212338_90H_ALT120.png?v=1765211996&width=750" onclick="abrirModalForm('Crocs')" alt="Nike item 3">
                    <img src="https://crocs.com.mx/cdn/shop/files/212260_997_ALT100.png?v=1764971619&width=750" onclick="abrirModalForm('Crocs')" alt="Nike item 4">
                </div>
            </div>
        </div>

        <div class="brand-item">
        <button class="brand-toggle">Coach <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="Coach/C1.png" onclick="abrirModalForm('Coach')" alt="Nike item 1">
                    <img src="Coach/c2.png" onclick="abrirModalForm('Coach')" alt="Nike item 2">
                    <img src="Coach/c3.png" onclick="abrirModalForm('Coach')" alt="Nike item 3">
                    <img src="Coach/c4.png" onclick="abrirModalForm('Coach')" alt="Nike item 4">
                </div>
            </div>
        </div>

        <div class="brand-item">
            <button class="brand-toggle">Guess <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://guessmx.vteximg.com.br/arquivos/ids/668646-300-auto?v=6385484833719000001&width=300&height=auto&aspect=true" onclick="abrirModalForm('Guess')" alt="Nike item 1">
                    <img src="https://cdn5.coppel.com/pr/3016602-1.jpg?iresize=width:400,height:320" onclick="abrirModalForm('Guess')" alt="Nike item 2">
                    <img src="https://resources.claroshop.com/medios-plazavip/mkt/62fd5f1682a3f_2png.jpg" onclick="abrirModalForm('Guess')" alt="Nike item 3">
                    <img src="https://guessmx.vtexassets.com/arquivos/ids/661470/Guess-Reloj-Hombre-GW0714G2-ORO-ALT1.jpg?v=638507017225270000" onclick="abrirModalForm('Guess')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Steve Madden <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://resources.sears.com.mx/medios-plazavip/t1/1720207365ProyectoCambiartamanodeimagen6png" onclick="abrirModalForm('Steve Madden')" alt="Nike item 1">
                    <img src="https://i5.walmartimages.com/asr/776abd18-e377-4712-9d95-3b3acfe0c5ff.b90db8cf7bbc3b15119618697c4f34c9.jpeg?odnHeight=612&odnWidth=612&odnBg=FFFFFF" onclick="abrirModalForm('Steve Madden')" alt="Nike item 2">
                    <img src="https://stevemadden.com.mx/cdn/shop/files/possession-e-coconut-milk-bronze-tenis-blancos-con-beige.jpg?v=1738102705" onclick="abrirModalForm('Steve Madden')" alt="Nike item 3">
                    <img src="https://resources.claroshop.com/medios-plazavip/t1/17214256741png" onclick="abrirModalForm('Steve Madden')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Polo <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://andreamx.vtexassets.com/arquivos/ids/17250971-800-800?v=638623084137430000&width=800&height=800&aspect=true" onclick="abrirModalForm('Polo')" alt="Nike item 1">
                    <img src="https://shendyvendy.com/cdn/shop/files/BEIGE_97d6e7bb-262d-47be-b02d-dba6a9bed41e.jpg?v=1740768190&width=1214" onclick="abrirModalForm('Polo')" alt="Nike item 2">
                    <img src="https://resources.sanborns.com.mx/imagenes-sanborns-ii/1200/7500413089904.jpg?scale=500&qlty=75" onclick="abrirModalForm('Polo')" alt="Nike item 3">
                    <img src="https://ss376.liverpool.com.mx/xl/1159389991.jpg" onclick="abrirModalForm('Polo')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Nautica <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://nauticamexico.com/cdn/shop/products/NAUTICA_BOYS_JUNIOR_SS23_Q1_20.02NAUTICA_SS23Q1_BOYS_N3JI0705_FLETCHER_POLO_SHIRT_DARK_NAVY_FLATLAY_A_1024x1024_2x_82c7768c-ce0a-41fa-adaf-d356cfcd1493.jpg?v=1755800895" onclick="abrirModalForm('Nautica')" alt="Nike item 1">
                    <img src="https://b2cimpulsmx.vtexassets.com/arquivos/ids/377822-800-800?v=638716230235430000&width=800&height=800&aspect=true" onclick="abrirModalForm('Nautica')" alt="Nike item 2">
                    <img src="https://cdn11.bigcommerce.com/s-2vt02okold/images/stencil/1280x1280/products/2875/5238/HNAUB__88917.1731099890.jpg?c=1" onclick="abrirModalForm('Nautica')" alt="Nike item 3">
                    <img src="https://nauticamexico.com/cdn/shop/products/NAPNSS301_7dff2eb0-fdb8-4ea8-9623-58fadd4d81ff.jpg?v=1755801073" onclick="abrirModalForm('Nautica')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Tommy Hilfiger <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://m.media-amazon.com/images/I/31vhPceHHhL._AC_.jpg" onclick="abrirModalForm('Tommy Hilfiger')" alt="Nike item 1">
                    <img src="https://urbanna.mx/cdn/shop/files/09H2RV-1.jpg?v=1761156048" onclick="abrirModalForm('Tommy Hilfiger')" alt="Nike item 2">
                    <img src="https://www.viu.mx/img/1024/1024/resize/T/O/TOMY00006_x1_1.jpg" onclick="abrirModalForm('Tommy Hilfiger')" alt="Nike item 3">
                    <img src="https://resources.sears.com.mx/medios-plazavip/fotos/productos_sears1/original/4223059.jpg" onclick="abrirModalForm('Tommy Hilfiger')" alt="Nike item 4">
                </div>
            </div>
        </div>

         <div class="brand-item">
            <button class="brand-toggle">Calvin Klein <span class="arrow">+</span></button>
            <div class="brand-content">
                <div class="collage-grid">
                    <img src="https://m.media-amazon.com/images/I/31dGwR0UBGL._AC_SY1000_.jpg" onclick="abrirModalForm('Calvin Klein')" alt="Nike item 1">
                    <img src="https://m.media-amazon.com/images/I/617tSYclx0L._AC_SL1500_.jpg" onclick="abrirModalForm('Calvin Klein')" alt="Nike item 2">
                    <img src="https://perfumate.mx/cdn/shop/products/61ufv9EFQgL._AC_SL1000.jpg?v=1675881202" onclick="abrirModalForm('Calvin Klein')" alt="Nike item 3">
                    <img src="https://cristaljoyas.com/media/catalog/product/cache/f06412bcaeffb4364662cfc53d14e291/c/k/cklk9h211c1.jpg" onclick="abrirModalForm('Calvin Klein')" alt="Nike item 4">
                </div>
            </div>
        </div>
    </div>  
</section>

    <section class="trust-banner">
        <h2>100% ORIGINAL ‚Ä¢ GARANTIZADO</h2>
        <p>Olv√≠date de aduanas y env√≠os complicados.</p>
    </section>

    <div id="modalFormEncargo" class="modal-pedido-overlay">
        <div class="modal-pedido-box">
            <span class="cerrar-x" onclick="cerrarTodosModales()">&times;</span>
            <h2>Datos del Pedido</h2>
            <div class="form-encargo">
                <div class="form-group">
                    <label>Tu Nombre</label>
                    <input type="text" id="pNombre" placeholder="Nombre completo">
                </div>
                <div class="form-group">
                    <label>Tel√©fono (WhatsApp)</label>
                    <input type="tel" id="pTelefono" placeholder="Ej. 999 123 4567">
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex: 1;">
                        <label>Marca</label>
                        <input type="text" id="pMarca" placeholder="Ej. Nike">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Sistema de Talla</label>
                        <select id="pSistema">
                            <option value="MX">MEXICANA (cm)</option>
                            <option value="US">AMERICANA (US)</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex: 2;">
                        <label>Modelo del Producto</label>
                        <input type="text" id="pModelo" placeholder="Ej. Jordan 1 Retro High">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Talla</label>
                        <input type="text" id="pTalla" placeholder="Ej. 27 / 9">
                    </div>
                </div>
                <div class="form-group">
                    <label>Link o Notas adicionales</label>
                    <textarea id="pNotas" rows="2" placeholder="Pega el link o el color..."></textarea>
                </div>
                <button class="btn-modal btn-negro" onclick="generarTicketVisual()">SIGUIENTE: GENERAR TICKET</button>
            </div>
        </div>
    </div>

    <div id="modalTicketFinal" class="modal-pedido-overlay">
        <div class="modal-pedido-box">
            <span class="cerrar-x" onclick="cerrarTodosModales()">&times;</span>
            <h2>Ticket de Solicitud</h2>
            <div id="ticket-render">
                <div class="ticket-header-img">
                    <img src="NC.jpg" alt="Logo">
                    <div style="font-size: 0.7rem; font-weight: 700; margin-top: 5px;">NC WEST COAST</div>
                </div>
                <div id="ticket-data"></div>
                <div style="text-align: center; font-size: 0.6rem; color: #999; margin-top: 10px;">
                    SOLICITUD PROCESADA DESDE PORTAL WEB
                </div>
            </div>
            <button id="btnFinalMessenger" class="btn-modal btn-verde" onclick="abrirMessengerPedido()">COPIAR DATOS E IR AL CHAT</button>
        </div>
    </div>

    <div id="imageModal" class="image-modal">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="img01">
    </div>

    <script>
        let enlaceTicket = "";

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('folio')) {
                document.getElementById('ticket-data').innerHTML = `
                    <div class="ticket-item"><span>FOLIO:</span><span>#${params.get('folio')}</span></div>
                    <div class="ticket-item"><span>CLIENTE:</span><span>${params.get('nom').toUpperCase()}</span></div>
                    <div class="ticket-item"><span>TEL√âFONO:</span><span>${params.get('tel')}</span></div>
                    <div class="ticket-item"><span>MARCA:</span><span>${params.get('mar')}</span></div>
                    <div class="ticket-item"><span>MODELO:</span><span>${params.get('mod')}</span></div>
                    <div class="ticket-item"><span>TALLA:</span><span>${params.get('tal')} (${params.get('sis')})</span></div>
                    <div class="ticket-item"><span>FECHA:</span><span>${params.get('fecha')}</span></div>
                `;
                document.getElementById('modalTicketFinal').style.display = 'flex';
                document.getElementById('btnFinalMessenger').innerText = "TICKET OFICIAL NC";
                document.getElementById('btnFinalMessenger').onclick = null;
            }
        };

        // L√≥gica mejorada para abrir el formulario y permitir el llenado autom√°tico de marca
        function abrirModalForm(marca = "") {
            const campoMarca = document.getElementById('pMarca');
            if (marca) {
                campoMarca.value = marca;
            } else {
                campoMarca.value = "";
            }
            document.getElementById('modalFormEncargo').style.display = 'flex';
        }

        function cerrarTodosModales() {
            document.getElementById('modalFormEncargo').style.display = 'none';
            document.getElementById('modalTicketFinal').style.display = 'none';
        }

        function generarTicketVisual() {
            const nom = document.getElementById('pNombre').value;
            const tel = document.getElementById('pTelefono').value;
            const mar = document.getElementById('pMarca').value;
            const mod = document.getElementById('pModelo').value;
            const tal = document.getElementById('pTalla').value;
            const sis = document.getElementById('pSistema').value;
            const not = document.getElementById('pNotas').value || "Ninguna";
            const fecha = new Date().toLocaleDateString();
            const folio = Math.floor(1000 + Math.random() * 9000);

            if(!nom || !mar || !mod || !tel || !tal) {
                alert("Por favor completa los campos obligatorios");
                return;
            }

            document.getElementById('ticket-data').innerHTML = `
                <div class="ticket-item"><span>FOLIO:</span><span>#${folio}</span></div>
                <div class="ticket-item"><span>CLIENTE:</span><span>${nom.toUpperCase()}</span></div>
                <div class="ticket-item"><span>TEL√âFONO:</span><span>${tel}</span></div>
                <div class="ticket-item"><span>MARCA:</span><span>${mar}</span></div>
                <div class="ticket-item"><span>MODELO:</span><span>${mod}</span></div>
                <div class="ticket-item"><span>TALLA:</span><span>${tal} (${sis})</span></div>
            `;

            const baseURL = window.location.href.split('?')[0];
            enlaceTicket = `${baseURL}?folio=${folio}&nom=${encodeURIComponent(nom)}&tel=${encodeURIComponent(tel)}&mar=${encodeURIComponent(mar)}&mod=${encodeURIComponent(mod)}&tal=${encodeURIComponent(tal)}&sis=${encodeURIComponent(sis)}&fecha=${encodeURIComponent(fecha)}`;

            document.getElementById('modalFormEncargo').style.display = 'none';
            document.getElementById('modalTicketFinal').style.display = 'flex';
        }

        // Nueva funci√≥n Messenger: Texto formateado para evitar bloqueos de FB
        function abrirMessengerPedido() {
            const pageID = "859771300559984";
            const btn = document.getElementById('btnFinalMessenger');
            
            const nom = document.getElementById('pNombre').value.toUpperCase();
            const tel = document.getElementById('pTelefono').value;
            const mar = document.getElementById('pMarca').value;
            const mod = document.getElementById('pModelo').value;
            const tal = document.getElementById('pTalla').value;
            const sis = document.getElementById('pSistema').value;

            // Formato de texto puro con emojis (Sustituye al link para mayor seguridad)
            const mensajeFinal = `üåä *NC WEST COAST - SOLICITUD DE ENCARGO*\n\n` +
                                 `üë§ CLIENTE: ${nom}\n` +
                                 `üìû TEL: ${tel}\n` +
                                 `üì¶ MARCA: ${mar}\n` +
                                 `üëü MODELO: ${mod}\n` +
                                 `üìè TALLA: ${tal} (${sis})\n\n` +
                                 `_Hola, acabo de generar mi ticket en el portal. ¬øPodr√≠an darme precio y disponibilidad?_`;

            navigator.clipboard.writeText(mensajeFinal).then(() => {
                btn.innerText = "‚úÖ DATOS COPIADOS";
                btn.style.backgroundColor = "#27ae60";
                
                setTimeout(() => {
                    // Abrimos Messenger directamente al chat
                    window.open(`https://m.me/${pageID}`, '_blank');
                    cerrarTodosModales();
                    btn.innerText = "COPIAR DATOS E IR AL CHAT";
                    btn.style.backgroundColor = "#27ae60";
                }, 1000);
            });
        }
    </script>
</body>
</html>